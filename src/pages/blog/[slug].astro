---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import BlogHeader from "../../components/BlogHeader.astro";
import BlogFooter from "../../components/BlogFooter.astro";
import BlogTOC from "../../components/BlogTOC.astro";

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props as {
  post: Awaited<ReturnType<typeof getCollection>>[number];
};
const { Content, headings } = await post.render();
const { title, description, date, image, readingTime } = post.data;
const canonical = new URL(Astro.url.pathname, Astro.site).toString();
const blogSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "image": new URL(image, Astro.site).toString(),
  "author": {
    "@type": "Person",
    "name": "Jordi Mart√≠nez Joyeux",
  },
  "datePublished": date,
  "dateModified": date,
  "mainEntityOfPage": canonical,
  "description": description,
};
---

<Layout {title} {description} {canonical} footerSticky={false} schema={blogSchema}>
  <article class="max-w-4xl lg:max-w-6xl mx-auto pb-16">
    <BlogHeader 
      title={title} 
      image={image} 
      date={date} 
      readingTime={readingTime} 
    />
    
    <div class="grid lg:grid-cols-[1fr_250px] gap-8 px-6">
      <div class="order-first lg:order-last">
        <BlogTOC headings={headings} />
      </div>

        <main class="order-last lg:order-first prose prose-blog lg:prose-lg prose-headings:font-bold prose-headings:text-purple-800 prose-a:text-purple-600 hover:prose-a:text-purple-800 prose-blockquote:border-l-purple-600 prose-blockquote:bg-purple-50 prose-blockquote:px-6 prose-blockquote:py-4 prose-blockquote:rounded-r-lg max-w-none">
        <Content />
      </main>
    </div>

    <BlogFooter url={canonical} title={title} />
  </article>
</Layout>
