---
// src/components/Nav.astro
---

<nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50" role="navigation" aria-label="Navegación principal">
  <div class="container mx-auto px-6">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <a
        href="/"
        class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-600 to-purple-700"
      >
        Páginas a Medida
      </a>

      <!-- Menú Desktop (hidden en móvil) -->
      <div class="hidden md:flex items-center space-x-8">
        <a href="/" class="text-gray-700 hover:text-purple-700 transition">Inicio</a>

        <!-- Servicios (submenu) -->
        <div class="relative" id="desktop-services">
          <button
            id="desktop-services-btn"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="desktop-services-menu"
            class="flex items-center text-gray-700 hover:text-purple-700 transition"
          >
            <span>Servicios</span>
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div
            id="desktop-services-menu"
            class="absolute hidden bg-white shadow-lg rounded-md py-2 w-56 z-50 border border-gray-100"
            role="menu"
            aria-labelledby="desktop-services-btn"
          >
            <a href="/servicios/diseno-web/" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-700" role="menuitem" tabindex="-1">Diseño Web</a>
            <a href="/servicios/ecommerce/" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-700" role="menuitem" tabindex="-1">E-commerce</a>
            <a href="/servicios/seo/" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-700" role="menuitem" tabindex="-1">SEO</a>
            <a href="/servicios/ads/" class="block px-4 py-2 text-gray-700 hover:bg-purple-50 hover:text-purple-700" role="menuitem" tabindex="-1">Publicidad (ADS)</a>
          </div>
        </div>

        <a href="/sobre-mi/" class="text-gray-700 hover:text-purple-700 transition">Sobre Mí</a>
        <a href="/blog/" class="text-gray-700 hover:text-purple-700 transition">Blog</a>
        <a href="/contacto/" class="text-gray-700 hover:text-purple-700 transition">Contacto</a>
      </div>

      <!-- Botón Hamburguesa (solo móvil) -->
      <button
        class="md:hidden text-gray-700 focus:outline-none"
        id="menu-btn"
        type="button"
        aria-label="Abrir menú de navegación"
        aria-controls="mobile-menu"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Menú Móvil (hidden por defecto) -->
    <div class="hidden md:hidden py-4" id="mobile-menu">
      <a href="/" class="block py-2 text-gray-700 hover:text-purple-700">Inicio</a>

      <!-- Servicios con submenú (móvil) -->
      <div>
        <button
          id="mobile-services-btn"
          type="button"
          class="flex w-full items-center justify-between py-2 text-gray-700 hover:text-purple-700"
          aria-haspopup="true"
          aria-expanded="false"
          aria-controls="mobile-services-menu"
        >
          <span>Servicios</span>
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="mobile-services-menu" class="hidden pl-4">
          <a href="/servicios/diseno-web/" class="block py-2 text-gray-700 hover:text-purple-700">Diseño Web</a>
          <a href="/servicios/ecommerce/" class="block py-2 text-gray-700 hover:text-purple-700">E-commerce</a>
          <a href="/servicios/seo/" class="block py-2 text-gray-700 hover:text-purple-700">SEO</a>
          <a href="/servicios/ads/" class="block py-2 text-gray-700 hover:text-purple-700">Publicidad (ADS)</a>
        </div>
      </div>

      <a href="/sobre-mi/" class="block py-2 text-gray-700 hover:text-purple-700">Sobre Mí</a>
      <a href="/blog/" class="block py-2 text-gray-700 hover:text-purple-700">Blog</a>
      <a href="/contacto/" class="block py-2 text-gray-700 hover:text-purple-700">Contacto</a>
    </div>
  </div>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      // Helpers
      const qs = (sel, root = document) => root.querySelector(sel);
      const qsa = (sel, root = document) => Array.from(root.querySelectorAll(sel));

      // Desktop submenu
      const dBtn = qs('#desktop-services-btn');
      const dMenu = qs('#desktop-services-menu');

      function openDesktopMenu() {
        if (!dBtn || !dMenu) return;
        dMenu.classList.remove('hidden');
        dBtn.setAttribute('aria-expanded', 'true');
        // focus first item
        const firstItem = dMenu.querySelector('a[href]');
        if (firstItem) firstItem.focus();
      }
      function closeDesktopMenu() {
        if (!dBtn || !dMenu) return;
        dMenu.classList.add('hidden');
        dBtn.setAttribute('aria-expanded', 'false');
      }
      function toggleDesktopMenu() {
        if (!dMenu) return;
        dMenu.classList.contains('hidden') ? openDesktopMenu() : closeDesktopMenu();
      }

      if (dBtn && dMenu) {
        dBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleDesktopMenu();
        });
        dBtn.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openDesktopMenu();
          }
        });
        dMenu.addEventListener('keydown', (e) => {
          const items = qsa('a[href]', dMenu);
          const i = items.indexOf(document.activeElement);
          if (e.key === 'Escape') {
            e.preventDefault();
            closeDesktopMenu();
            dBtn.focus();
          } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            (items[i + 1] || items[0])?.focus();
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            (items[i - 1] || items.at(-1))?.focus();
          } else if (e.key === 'Home') {
            e.preventDefault();
            items[0]?.focus();
          } else if (e.key === 'End') {
            e.preventDefault();
            items.at(-1)?.focus();
          }
        });
        // Click fuera
        document.addEventListener('click', (e) => {
          if (!dMenu.classList.contains('hidden') && !dBtn.contains(e.target) && !dMenu.contains(e.target)) {
            closeDesktopMenu();
          }
        });
      }

      // Mobile menu
      const mBtn = qs('#menu-btn');
      const mMenu = qs('#mobile-menu');
      if (mBtn && mMenu) {
        mBtn.addEventListener('click', () => {
          const isHidden = mMenu.classList.toggle('hidden');
          mBtn.setAttribute('aria-expanded', String(!isHidden));
        });
      }

      // Mobile services submenu
      const msBtn = qs('#mobile-services-btn');
      const msMenu = qs('#mobile-services-menu');
      if (msBtn && msMenu) {
        msBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const isHidden = msMenu.classList.toggle('hidden');
          msBtn.setAttribute('aria-expanded', String(!isHidden));
        });
      }

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (dMenu && !dMenu.classList.contains('hidden')) closeDesktopMenu();
        }
      });
    });
  </script>

  <style is:global>
    @media (prefers-reduced-motion: reduce) {
      * { transition-duration: 0.01ms !important; animation-duration: 0.01ms !important; }
    }
  </style>
</nav>
